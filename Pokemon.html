<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guess the Pok√©mon!</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
      transition: background 0.5s;
    }

    body.correct-bg {
      background: linear-gradient(135deg, #1a4a2e 0%, #16413e 100%);
    }

    body.wrong-bg {
      background: linear-gradient(135deg, #4a1a1a 0%, #3e1616 100%);
    }

    /* Background floating particles */
    .bg-particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      animation: floatBg 20s infinite linear;
    }

    @keyframes floatBg {
      0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
    }

    .game-container {
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 30px;
      max-width: 550px;
      width: 100%;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      position: relative;
      z-index: 1;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .game-container.rainbow-border {
      animation: rainbowBorder 2s linear infinite;
    }

    @keyframes rainbowBorder {
      0% { border-color: #ff0000; box-shadow: 0 0 30px #ff0000; }
      17% { border-color: #ff8800; box-shadow: 0 0 30px #ff8800; }
      33% { border-color: #ffff00; box-shadow: 0 0 30px #ffff00; }
      50% { border-color: #00ff00; box-shadow: 0 0 30px #00ff00; }
      67% { border-color: #0088ff; box-shadow: 0 0 30px #0088ff; }
      83% { border-color: #8800ff; box-shadow: 0 0 30px #8800ff; }
      100% { border-color: #ff0000; box-shadow: 0 0 30px #ff0000; }
    }

    /* Main Menu Styles */
    .main-menu {
      text-align: center;
    }

    .main-menu h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #f39c12, #e74c3c, #9b59b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .main-menu .subtitle {
      color: #aaa;
      margin-bottom: 30px;
    }

    .menu-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }

    .menu-btn {
      padding: 20px 30px;
      font-size: 1.2rem;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .menu-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .menu-btn.random {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .menu-btn.challenge {
      background: linear-gradient(135deg, #f39c12, #e67e22);
      color: white;
    }

    .menu-btn.badges {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
    }

    .menu-btn .icon {
      font-size: 1.5rem;
    }

    /* Badge Collection */
    .badge-collection {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .badge-collection h3 {
      margin-bottom: 15px;
      color: #f39c12;
    }

    .badges-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }

    .badge-slot {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      transition: all 0.3s;
      position: relative;
    }

    .badge-slot.locked {
      background: rgba(255,255,255,0.1);
      color: #555;
    }

    .badge-slot.earned {
      animation: badgeShine 2s infinite;
      box-shadow: 0 0 15px currentColor;
    }

    .badge-slot .badge-tooltip {
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.7rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .badge-slot:hover .badge-tooltip {
      opacity: 1;
    }

    /* Type Selection Screen */
    .type-selection {
      text-align: center;
    }

    .type-selection h2 {
      margin-bottom: 20px;
    }

    .types-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .type-select-btn {
      padding: 15px 10px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.85rem;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .type-select-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .type-select-btn .badge-earned {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 0.8rem;
    }

    .type-select-btn .progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: rgba(255,255,255,0.5);
      transition: width 0.3s;
    }

    .back-btn {
      padding: 10px 25px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .back-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Challenge Progress Bar */
    .challenge-progress {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
    }

    .challenge-progress .type-label {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .challenge-progress .type-badge-large {
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      text-transform: uppercase;
    }

    .progress-bar-container {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      height: 25px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      border-radius: 10px;
      transition: width 0.5s ease-out;
      background: linear-gradient(90deg, #27ae60, #2ecc71);
      position: relative;
    }

    .progress-bar.almost {
      background: linear-gradient(90deg, #f39c12, #e67e22);
      animation: almostThere 0.5s ease-in-out infinite alternate;
    }

    @keyframes almostThere {
      from { box-shadow: 0 0 10px #f39c12; }
      to { box-shadow: 0 0 20px #e67e22; }
    }

    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }

    /* Shake animation */
    .shake {
      animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
    }

    @keyframes shake {
      10%, 90% { transform: translateX(-2px); }
      20%, 80% { transform: translateX(4px); }
      30%, 50%, 70% { transform: translateX(-8px); }
      40%, 60% { transform: translateX(8px); }
    }

    .mega-shake {
      animation: megaShake 0.8s cubic-bezier(.36,.07,.19,.97) both;
    }

    @keyframes megaShake {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      10% { transform: translate(-10px, -5px) rotate(-2deg); }
      20% { transform: translate(10px, 5px) rotate(2deg); }
      30% { transform: translate(-10px, 5px) rotate(-2deg); }
      40% { transform: translate(10px, -5px) rotate(2deg); }
      50% { transform: translate(-5px, 10px) rotate(-1deg); }
      60% { transform: translate(5px, -10px) rotate(1deg); }
      70% { transform: translate(-5px, -5px) rotate(-1deg); }
      80% { transform: translate(5px, 5px) rotate(1deg); }
      90% { transform: translate(-2px, 2px) rotate(0deg); }
    }

    .flash-correct {
      animation: flashCorrect 0.5s ease-out;
    }

    .flash-wrong {
      animation: flashWrong 0.5s ease-out;
    }

    @keyframes flashCorrect {
      0% { box-shadow: 0 0 0 0 rgba(46, 213, 115, 0.8); }
      50% { box-shadow: 0 0 80px 40px rgba(46, 213, 115, 0.6); }
      100% { box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
    }

    @keyframes flashWrong {
      0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.8); }
      50% { box-shadow: 0 0 80px 40px rgba(231, 76, 60, 0.6); }
      100% { box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.8rem;
      transition: all 0.3s;
    }

    h1.celebrate {
      animation: celebrateTitle 0.5s ease-out;
    }

    @keyframes celebrateTitle {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .score-board {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      font-size: 1.1rem;
    }

    .score-board span {
      background: rgba(255,255,255,0.1);
      padding: 5px 15px;
      border-radius: 20px;
      transition: all 0.3s;
    }

    .score-board span.pop {
      animation: pop 0.4s ease-out;
    }

    .score-board span.mega-pop {
      animation: megaPop 0.6s ease-out;
    }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    @keyframes megaPop {
      0% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.5) rotate(-10deg); }
      50% { transform: scale(1.3) rotate(10deg); }
      75% { transform: scale(1.4) rotate(-5deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    .streak-fire {
      background: linear-gradient(135deg, #f39c12, #e74c3c) !important;
      animation: fire 0.3s ease-in-out infinite alternate;
    }

    @keyframes fire {
      from { box-shadow: 0 0 10px #f39c12, 0 0 20px #e74c3c; }
      to { box-shadow: 0 0 20px #e74c3c, 0 0 40px #f39c12, 0 0 60px #ff6b6b; }
    }

    .streak-legendary {
      background: linear-gradient(135deg, #9b59b6, #3498db, #1abc9c) !important;
      background-size: 200% 200%;
      animation: legendaryGlow 1s ease-in-out infinite;
    }

    @keyframes legendaryGlow {
      0% { background-position: 0% 50%; box-shadow: 0 0 20px #9b59b6; }
      50% { background-position: 100% 50%; box-shadow: 0 0 30px #3498db; }
      100% { background-position: 0% 50%; box-shadow: 0 0 20px #1abc9c; }
    }

    .mystery-pokemon {
      text-align: center;
      margin-bottom: 20px;
      padding: 30px;
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      position: relative;
    }

    .mystery-icon {
      font-size: 5rem;
      animation: mysteryPulse 2s ease-in-out infinite;
    }

    @keyframes mysteryPulse {
      0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
      50% { transform: scale(1.1); filter: drop-shadow(0 0 20px rgba(255,255,255,0.5)); }
    }

    .mystery-text {
      margin-top: 10px;
      font-size: 1.2rem;
      color: #aaa;
      font-style: italic;
    }

    .hints-section {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s;
    }

    .types-container {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .type-badge {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: bold;
      text-transform: uppercase;
      transition: all 0.3s;
    }

    .type-badge:hover {
      transform: scale(1.1);
    }

    .stats-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .stat-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stat-name {
      width: 80px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .stat-bar-container {
      flex: 1;
      height: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .stat-bar {
      height: 100%;
      border-radius: 10px;
      width: 0;
      transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .stat-value {
      width: 40px;
      text-align: right;
      font-weight: bold;
    }

    .extra-hints {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      font-size: 0.9rem;
    }

    .hint-item {
      background: rgba(255,255,255,0.1);
      padding: 8px 12px;
      border-radius: 10px;
      transition: all 0.3s;
    }

    .hint-item:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }

    .hint-label {
      color: #888;
      font-size: 0.8rem;
    }

    .guess-section {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    #guess-input {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      background: rgba(255,255,255,0.9);
      color: #333;
      transition: all 0.3s;
    }

    #guess-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px #667eea, 0 0 20px rgba(102, 126, 234, 0.5);
    }

    #guess-input.wrong {
      animation: inputWrong 0.5s ease-in-out;
      background: rgba(231, 76, 60, 0.3);
      color: white;
    }

    #guess-input.correct-input {
      animation: inputCorrect 0.5s ease-in-out;
      background: rgba(46, 213, 115, 0.3);
      color: white;
    }

    @keyframes inputWrong {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }

    @keyframes inputCorrect {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(46, 213, 115, 0.8); }
      100% { transform: scale(1); }
    }

    button {
      padding: 15px 25px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:active::before {
      width: 300px;
      height: 300px;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    button:active {
      transform: scale(0.95);
    }

    #submit-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    #hint-btn {
      background: linear-gradient(135deg, #f39c12, #e67e22);
      color: white;
    }

    #next-btn, #skip-btn {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
    }

    #skip-btn {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    #next-btn {
      animation: pulse 1.5s infinite, glow 1s infinite alternate;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
      50% { box-shadow: 0 0 0 15px rgba(39, 174, 96, 0); }
    }

    @keyframes glow {
      from { filter: brightness(1); }
      to { filter: brightness(1.2); }
    }

    .button-row {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .result {
      text-align: center;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 15px;
      display: none;
      overflow: hidden;
      position: relative;
    }

    .result.correct {
      background: linear-gradient(135deg, rgba(39, 174, 96, 0.4), rgba(46, 213, 115, 0.4));
      display: block;
      animation: resultCorrect 0.6s ease-out;
      border: 2px solid rgba(46, 213, 115, 0.5);
    }

    .result.incorrect {
      background: linear-gradient(135deg, rgba(231, 76, 60, 0.4), rgba(192, 57, 43, 0.4));
      display: block;
      animation: resultIncorrect 0.6s ease-out;
      border: 2px solid rgba(231, 76, 60, 0.5);
    }

    @keyframes resultCorrect {
      0% { opacity: 0; transform: scale(0.5) rotateX(90deg); }
      50% { transform: scale(1.1) rotateX(-10deg); }
      100% { opacity: 1; transform: scale(1) rotateX(0); }
    }

    @keyframes resultIncorrect {
      0% { opacity: 0; transform: translateY(-50px); }
      60% { transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .result h2 {
      text-transform: capitalize;
      margin: 10px 0;
    }

    .result.correct h2 {
      animation: textGlow 1s ease-in-out infinite alternate;
    }

    @keyframes textGlow {
      from { text-shadow: 0 0 10px rgba(46, 213, 115, 0.5); }
      to { text-shadow: 0 0 20px rgba(46, 213, 115, 1), 0 0 30px rgba(46, 213, 115, 0.5); }
    }

    .pokemon-reveal {
      margin: 15px 0;
      position: relative;
    }

    .pokemon-reveal img {
      width: 150px;
      height: 150px;
      object-fit: contain;
    }

    .pokemon-reveal img.correct-reveal {
      animation: pokemonRevealCorrect 1s ease-out forwards;
      filter: drop-shadow(0 0 30px rgba(255, 215, 0, 1));
    }

    .pokemon-reveal img.wrong-reveal {
      animation: pokemonRevealWrong 0.8s ease-out forwards;
      filter: drop-shadow(0 0 20px rgba(231, 76, 60, 0.8)) grayscale(0.3);
    }

    @keyframes pokemonRevealCorrect {
      0% { transform: scale(0) rotateY(0deg); opacity: 0; }
      50% { transform: scale(1.3) rotateY(180deg); }
      75% { transform: scale(1.1) rotateY(360deg); }
      100% { transform: scale(1) rotateY(360deg); opacity: 1; }
    }

    @keyframes pokemonRevealWrong {
      0% { transform: scale(0.3) translateY(-50px); opacity: 0; }
      60% { transform: scale(1.1) translateY(10px); }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    .hint-text {
      text-align: center;
      color: #f39c12;
      margin-bottom: 10px;
      font-style: italic;
      min-height: 24px;
    }

    .hint-text.pop {
      animation: hintPop 0.3s ease-out;
    }

    @keyframes hintPop {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .loading {
      text-align: center;
      padding: 50px;
    }

    .pokeball-loader {
      width: 60px;
      height: 60px;
      margin: 0 auto 20px;
      position: relative;
      animation: bounce 0.5s infinite alternate;
    }

    .pokeball-loader::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(180deg, #ff0000 0%, #ff0000 45%, #333 45%, #333 55%, white 55%, white 100%);
      box-shadow: inset 0 -5px 10px rgba(0,0,0,0.2);
    }

    .pokeball-loader::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border: 4px solid #333;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    @keyframes bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-15px); }
    }

    /* Type colors */
    .type-normal { background: linear-gradient(135deg, #A8A878, #C6C6A7); color: #333; }
    .type-fire { background: linear-gradient(135deg, #F08030, #F5AC78); color: white; }
    .type-water { background: linear-gradient(135deg, #6890F0, #9DB7F5); color: white; }
    .type-electric { background: linear-gradient(135deg, #F8D030, #FAE078); color: #333; }
    .type-grass { background: linear-gradient(135deg, #78C850, #A7DB8D); color: #333; }
    .type-ice { background: linear-gradient(135deg, #98D8D8, #BCE6E6); color: #333; }
    .type-fighting { background: linear-gradient(135deg, #C03028, #D67873); color: white; }
    .type-poison { background: linear-gradient(135deg, #A040A0, #C183C1); color: white; }
    .type-ground { background: linear-gradient(135deg, #E0C068, #EBD69D); color: #333; }
    .type-flying { background: linear-gradient(135deg, #A890F0, #C6B7F5); color: #333; }
    .type-psychic { background: linear-gradient(135deg, #F85888, #FA92B2); color: white; }
    .type-bug { background: linear-gradient(135deg, #A8B820, #C6D16E); color: #333; }
    .type-rock { background: linear-gradient(135deg, #B8A038, #D1C17D); color: #333; }
    .type-ghost { background: linear-gradient(135deg, #705898, #A292BC); color: white; }
    .type-dragon { background: linear-gradient(135deg, #7038F8, #A27DFA); color: white; }
    .type-dark { background: linear-gradient(135deg, #705848, #A29288); color: white; }
    .type-steel { background: linear-gradient(135deg, #B8B8D0, #D1D1E0); color: #333; }
    .type-fairy { background: linear-gradient(135deg, #EE99AC, #F4BDC9); color: #333; }

    /* Stat colors */
    .stat-hp { background: linear-gradient(90deg, #FF5959, #ff8080); }
    .stat-attack { background: linear-gradient(90deg, #F5AC78, #f7c9a8); }
    .stat-defense { background: linear-gradient(90deg, #FAE078, #fceca8); }
    .stat-sp-atk { background: linear-gradient(90deg, #9DB7F5, #c2d1fa); }
    .stat-sp-def { background: linear-gradient(90deg, #A7DB8D, #c8e8b8); }
    .stat-speed { background: linear-gradient(90deg, #FA92B2, #fcb8cb); }

    .attempts {
      text-align: center;
      margin-bottom: 10px;
      color: #aaa;
    }

    #effects-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }

    .particle {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
      font-size: 2rem;
    }

    .particle.explode {
      animation: explodeOut 1s ease-out forwards;
    }

    @keyframes explodeOut {
      0% { opacity: 1; transform: translate(0, 0) scale(1); }
      100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0); }
    }

    .screen-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
      opacity: 0;
    }

    .screen-flash.green {
      background: radial-gradient(circle at center, rgba(46, 213, 115, 0.8) 0%, transparent 70%);
      animation: screenFlashGreen 0.6s ease-out;
    }

    .screen-flash.red {
      background: radial-gradient(circle at center, rgba(231, 76, 60, 0.8) 0%, transparent 70%);
      animation: screenFlashRed 0.4s ease-out;
    }

    .screen-flash.gold {
      background: radial-gradient(circle at center, rgba(255, 215, 0, 0.8) 0%, transparent 70%);
      animation: screenFlashGold 0.8s ease-out;
    }

    @keyframes screenFlashGreen {
      0% { opacity: 0; transform: scale(0.5); }
      30% { opacity: 1; transform: scale(1.2); }
      100% { opacity: 0; transform: scale(2); }
    }

    @keyframes screenFlashRed {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }

    @keyframes screenFlashGold {
      0% { opacity: 0; }
      30% { opacity: 1; }
      100% { opacity: 0; }
    }

    .streak-celebration {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      font-weight: bold;
      z-index: 1001;
      pointer-events: none;
      text-align: center;
      white-space: nowrap;
    }

    .streak-celebration.normal {
      color: #f39c12;
      text-shadow: 0 0 20px #f39c12, 0 0 40px #e74c3c;
      animation: streakNormal 1.2s ease-out forwards;
    }

    .streak-celebration.epic {
      background: linear-gradient(90deg, #ff0000, #ff8800, #ffff00, #00ff00, #0088ff, #8800ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255,255,255,0.8));
      animation: streakEpic 1.5s ease-out forwards;
    }

    @keyframes streakNormal {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
      20% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
      40% { transform: translate(-50%, -50%) scale(1.1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5) translateY(-50px); }
    }

    @keyframes streakEpic {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0) rotate(-180deg); }
      30% { opacity: 1; transform: translate(-50%, -50%) scale(1.5) rotate(10deg); }
      50% { transform: translate(-50%, -50%) scale(1.3) rotate(-5deg); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(2) rotate(0deg) translateY(-80px); }
    }

    .achievement {
      position: fixed;
      top: 20px;
      right: -350px;
      background: linear-gradient(135deg, #2c3e50, #34495e);
      border-left: 4px solid #f39c12;
      padding: 15px 20px;
      border-radius: 10px;
      z-index: 1002;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 5px 30px rgba(0,0,0,0.5);
      animation: achievementSlide 4s ease-in-out forwards;
    }

    @keyframes achievementSlide {
      0% { right: -350px; }
      15% { right: 20px; }
      85% { right: 20px; }
      100% { right: -350px; }
    }

    .achievement-icon {
      font-size: 2.5rem;
    }

    .achievement-text h3 {
      color: #f39c12;
      margin-bottom: 5px;
    }

    .achievement-text p {
      color: #bdc3c7;
      font-size: 0.9rem;
    }

    .screen-crack {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 998;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 0 L45 30 L20 35 L40 50 L30 100 M50 0 L55 25 L80 30 L60 45 L70 100 M40 50 L50 55 L60 45' fill='none' stroke='rgba(255,255,255,0.3)' stroke-width='0.5'/%3E%3C/svg%3E");
      background-size: cover;
      opacity: 0;
      animation: crackAppear 1s ease-out forwards;
    }

    @keyframes crackAppear {
      0% { opacity: 0; }
      10% { opacity: 0.8; }
      100% { opacity: 0; }
    }

    .ring-burst {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 997;
    }

    .ring {
      position: absolute;
      border: 3px solid;
      border-radius: 50%;
      animation: ringExpand 1s ease-out forwards;
    }

    @keyframes ringExpand {
      0% { width: 0; height: 0; opacity: 1; top: 50%; left: 50%; transform: translate(-50%, -50%); }
      100% { width: 300px; height: 300px; opacity: 0; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    }

    .perfect-badge {
      display: inline-block;
      background: linear-gradient(135deg, #f39c12, #e67e22);
      padding: 5px 15px;
      border-radius: 20px;
      margin-top: 10px;
      animation: badgeShine 2s infinite;
    }

    @keyframes badgeShine {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }

    .whos-that {
      font-size: 1.5rem;
      text-align: center;
      margin-bottom: 5px;
      color: #f39c12;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      animation: whosThatPulse 2s ease-in-out infinite;
    }

    @keyframes whosThatPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Badge Earned Celebration */
    .badge-earned-screen {
      text-align: center;
      padding: 20px;
    }

    .badge-earned-screen h1 {
      font-size: 2rem;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #f39c12, #e67e22);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .earned-badge-display {
      width: 150px;
      height: 150px;
      margin: 20px auto;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
      animation: badgeEarned 1s ease-out, badgeShine 2s infinite 1s;
    }

    @keyframes badgeEarned {
      0% { transform: scale(0) rotate(-180deg); opacity: 0; }
      50% { transform: scale(1.3) rotate(10deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    .badge-earned-screen p {
      margin: 15px 0;
      color: #aaa;
    }

    .badge-earned-screen .stats {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .badge-earned-screen .stats div {
      margin: 5px 0;
    }

    @media (max-width: 500px) {
      .game-container {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.4rem;
      }

      .stat-name {
        width: 60px;
        font-size: 0.75rem;
      }

      .extra-hints {
        font-size: 0.8rem;
      }

      .score-board {
        gap: 10px;
        font-size: 0.9rem;
      }

      .score-board span {
        padding: 5px 10px;
      }

      .types-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .badges-grid {
        grid-template-columns: repeat(4, 1fr);
      }

      .main-menu h1 {
        font-size: 2rem;
      }

      .menu-btn {
        padding: 15px 20px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="bg-particles" id="bg-particles"></div>
  <canvas id="effects-canvas"></canvas>
  
  <div class="game-container" id="game-container">
    <div id="game-content">
      <!-- Content will be loaded here -->
    </div>
  </div>

  <script>
    // ============ CONSTANTS ============
    const TYPES = [
      'normal', 'fire', 'water', 'electric', 'grass', 'ice',
      'fighting', 'poison', 'ground', 'flying', 'psychic', 'bug',
      'rock', 'ghost', 'dragon', 'dark', 'steel', 'fairy'
    ];

    const TYPE_ICONS = {
      normal: '‚ö™', fire: 'üî•', water: 'üíß', electric: '‚ö°', grass: 'üåø', ice: '‚ùÑÔ∏è',
      fighting: 'üëä', poison: '‚ò†Ô∏è', ground: 'üèîÔ∏è', flying: 'ü¶Ö', psychic: 'üîÆ', bug: 'üêõ',
      rock: 'ü™®', ghost: 'üëª', dragon: 'üêâ', dark: 'üåë', steel: '‚öôÔ∏è', fairy: '‚ú®'
    };

    const BADGE_GOAL = 20;

    // ============ GAME STATE ============
    let gameMode = 'menu'; // menu, random, challenge, type-select, badges
    let currentType = null;
    let currentPokemon = null;
    let currentImageUrl = '';
    let pokemonOfType = [];
    
    let hintsUsed = 0;
    let attempts = 0;
    let correctScore = 0;
    let wrongScore = 0;
    let streak = 0;
    let bestStreak = 0;
    let revealed = false;
    
    // Challenge mode
    let challengeProgress = {};
    let earnedBadges = [];

    // Load saved data
    function loadSaveData() {
      try {
        const saved = localStorage.getItem('pokemonGameData');
        if (saved) {
          const data = JSON.parse(saved);
          challengeProgress = data.challengeProgress || {};
          earnedBadges = data.earnedBadges || [];
          bestStreak = data.bestStreak || 0;
        }
      } catch (e) {
        console.log('No saved data found');
      }
    }

    function saveGameData() {
      const data = {
        challengeProgress,
        earnedBadges,
        bestStreak
      };
      localStorage.setItem('pokemonGameData', JSON.stringify(data));
    }

    loadSaveData();

    // ============ EFFECTS SYSTEM ============
    const canvas = document.getElementById('effects-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function createBgParticles() {
      const container = document.getElementById('bg-particles');
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'bg-particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (15 + Math.random() * 10) + 's';
        container.appendChild(particle);
      }
    }
    createBgParticles();

    class Particle {
      constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type;
        this.life = 1;
        this.decay = 0.02;
        
        if (type === 'confetti') {
          this.vx = (Math.random() - 0.5) * 15;
          this.vy = Math.random() * -15 - 5;
          this.gravity = 0.5;
          this.size = Math.random() * 10 + 5;
          this.rotation = Math.random() * 360;
          this.rotationSpeed = (Math.random() - 0.5) * 15;
          this.color = `hsl(${Math.random() * 360}, 80%, 60%)`;
        } else if (type === 'firework') {
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 8 + 4;
          this.vx = Math.cos(angle) * speed;
          this.vy = Math.sin(angle) * speed;
          this.gravity = 0.15;
          this.size = Math.random() * 4 + 2;
          this.color = `hsl(${Math.random() * 60 + 30}, 100%, 60%)`;
          this.trail = [];
        } else if (type === 'spark') {
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 6 + 2;
          this.vx = Math.cos(angle) * speed;
          this.vy = Math.sin(angle) * speed;
          this.gravity = 0.1;
          this.size = Math.random() * 3 + 1;
          this.color = '#FFD700';
        } else if (type === 'star') {
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 10 + 5;
          this.vx = Math.cos(angle) * speed;
          this.vy = Math.sin(angle) * speed;
          this.gravity = 0;
          this.size = Math.random() * 15 + 10;
          this.rotation = Math.random() * 360;
          this.decay = 0.03;
        } else if (type === 'wrong') {
          this.vx = (Math.random() - 0.5) * 8;
          this.vy = Math.random() * -10 - 5;
          this.gravity = 0.4;
          this.size = Math.random() * 8 + 4;
          this.rotation = Math.random() * 360;
          this.rotationSpeed = (Math.random() - 0.5) * 20;
          this.color = '#e74c3c';
        }
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (this.gravity) this.vy += this.gravity;
        if (this.rotationSpeed) this.rotation += this.rotationSpeed;
        this.life -= this.decay;
        
        if (this.type === 'firework' && this.trail) {
          this.trail.push({ x: this.x, y: this.y, life: 0.5 });
          if (this.trail.length > 10) this.trail.shift();
          this.trail.forEach(t => t.life -= 0.05);
        }
      }

      draw() {
        ctx.save();
        ctx.globalAlpha = this.life;
        
        if (this.type === 'confetti') {
          ctx.translate(this.x, this.y);
          ctx.rotate(this.rotation * Math.PI / 180);
          ctx.fillStyle = this.color;
          ctx.fillRect(-this.size / 2, -this.size / 4, this.size, this.size / 2);
        } else if (this.type === 'firework') {
          if (this.trail) {
            this.trail.forEach((t, i) => {
              ctx.globalAlpha = t.life * this.life;
              ctx.beginPath();
              ctx.arc(t.x, t.y, this.size * (i / this.trail.length), 0, Math.PI * 2);
              ctx.fillStyle = this.color;
              ctx.fill();
            });
          }
          ctx.globalAlpha = this.life;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
        } else if (this.type === 'spark' || this.type === 'wrong') {
          ctx.translate(this.x, this.y);
          if (this.rotation) ctx.rotate(this.rotation * Math.PI / 180);
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(0, 0, this.size, 0, Math.PI * 2);
          ctx.fill();
        } else if (this.type === 'star') {
          ctx.translate(this.x, this.y);
          ctx.rotate(this.rotation * Math.PI / 180);
          ctx.fillStyle = '#FFD700';
          ctx.beginPath();
          for (let i = 0; i < 5; i++) {
            const angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
            const x = Math.cos(angle) * this.size;
            const y = Math.sin(angle) * this.size;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.closePath();
          ctx.fill();
        }
        
        ctx.restore();
      }
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles = particles.filter(p => p.life > 0);
      particles.forEach(p => {
        p.update();
        p.draw();
      });
      if (particles.length > 0) {
        requestAnimationFrame(animate);
      }
    }

    function launchConfetti(count = 150) {
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          particles.push(new Particle(Math.random() * canvas.width, canvas.height + 20, 'confetti'));
        }, i * 10);
      }
      animate();
    }

    function launchFireworks(count = 5) {
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const x = Math.random() * canvas.width * 0.6 + canvas.width * 0.2;
          const y = Math.random() * canvas.height * 0.4 + canvas.height * 0.2;
          for (let j = 0; j < 50; j++) {
            particles.push(new Particle(x, y, 'firework'));
          }
        }, i * 300);
      }
      animate();
    }

    function launchSparks(x, y, count = 30) {
      for (let i = 0; i < count; i++) {
        particles.push(new Particle(x, y, 'spark'));
      }
      animate();
    }

    function launchStars(x, y, count = 12) {
      for (let i = 0; i < count; i++) {
        setTimeout(() => particles.push(new Particle(x, y, 'star')), i * 50);
      }
      animate();
    }

    function launchWrongParticles(x, y, count = 20) {
      for (let i = 0; i < count; i++) {
        particles.push(new Particle(x, y, 'wrong'));
      }
      animate();
    }

    // ============ SOUND SYSTEM ============
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
      if (audioContext.state === 'suspended') audioContext.resume();
      
      if (type === 'correct') {
        const notes = [523.25, 659.25, 783.99, 1046.50];
        notes.forEach((freq, i) => {
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
          osc.type = 'sine';
          gain.gain.setValueAtTime(0.3, audioContext.currentTime + i * 0.1);
          gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
          osc.start(audioContext.currentTime + i * 0.1);
          osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
        });
      } else if (type === 'wrong') {
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.frequency.setValueAtTime(200, audioContext.currentTime);
        osc.frequency.linearRampToValueAtTime(100, audioContext.currentTime + 0.2);
        osc.type = 'sawtooth';
        gain.gain.setValueAtTime(0.2, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        osc.start();
        osc.stop(audioContext.currentTime + 0.3);
      } else if (type === 'streak' || type === 'badge') {
        const notes = [523.25, 587.33, 659.25, 698.46, 783.99, 880, 987.77, 1046.50];
        notes.forEach((freq, i) => {
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.06);
          osc.type = 'sine';
          gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.06);
          gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.06 + 0.2);
          osc.start(audioContext.currentTime + i * 0.06);
          osc.stop(audioContext.currentTime + i * 0.06 + 0.2);
        });
      } else if (type === 'epic') {
        const melody = [
          { freq: 523.25, time: 0, dur: 0.15 },
          { freq: 659.25, time: 0.15, dur: 0.15 },
          { freq: 783.99, time: 0.3, dur: 0.15 },
          { freq: 1046.50, time: 0.45, dur: 0.4 },
          { freq: 880, time: 0.6, dur: 0.15 },
          { freq: 1046.50, time: 0.75, dur: 0.5 }
        ];
        melody.forEach(note => {
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.frequency.setValueAtTime(note.freq, audioContext.currentTime + note.time);
          osc.type = 'triangle';
          gain.gain.setValueAtTime(0.3, audioContext.currentTime + note.time);
          gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + note.time + note.dur);
          osc.start(audioContext.currentTime + note.time);
          osc.stop(audioContext.currentTime + note.time + note.dur);
        });
      } else if (type === 'hint') {
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.frequency.setValueAtTime(800, audioContext.currentTime);
        osc.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.15, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        osc.start();
        osc.stop(audioContext.currentTime + 0.2);
      }
    }

    // ============ VISUAL EFFECTS ============
    function createScreenFlash(color) {
      const flash = document.createElement('div');
      flash.className = `screen-flash ${color}`;
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 800);
    }

    function createFloatingEmoji(emoji, x, y, type = 'explode') {
      const particle = document.createElement('div');
      particle.className = `particle ${type}`;
      particle.textContent = emoji;
      particle.style.left = x + 'px';
      particle.style.top = y + 'px';
      if (type === 'explode') {
        const angle = Math.random() * Math.PI * 2;
        const distance = 100 + Math.random() * 100;
        particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
        particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
      }
      document.body.appendChild(particle);
      setTimeout(() => particle.remove(), 2000);
    }

    function createEmojiExplosion(emojis, count = 20) {
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const emoji = emojis[Math.floor(Math.random() * emojis.length)];
          createFloatingEmoji(emoji, centerX, centerY, 'explode');
        }, i * 30);
      }
    }

    function createRingBurst(color) {
      const container = document.createElement('div');
      container.className = 'ring-burst';
      for (let i = 0; i < 3; i++) {
        const ring = document.createElement('div');
        ring.className = 'ring';
        ring.style.borderColor = color;
        ring.style.animationDelay = i * 0.2 + 's';
        container.appendChild(ring);
      }
      document.body.appendChild(container);
      setTimeout(() => container.remove(), 1500);
    }

    function createScreenCrack() {
      const crack = document.createElement('div');
      crack.className = 'screen-crack';
      document.body.appendChild(crack);
      setTimeout(() => crack.remove(), 1000);
    }

    function showStreakCelebration(streakNum) {
      const celebration = document.createElement('div');
      celebration.className = 'streak-celebration';
      
      if (streakNum >= 10) {
        celebration.classList.add('epic');
        celebration.innerHTML = `üèÜ LEGENDARY! üèÜ<br>${streakNum} STREAK!`;
        playSound('epic');
        launchFireworks(8);
        createEmojiExplosion(['üèÜ', 'üëë', 'üíé', 'üåü', '‚ú®'], 30);
      } else if (streakNum >= 5) {
        celebration.classList.add('normal');
        celebration.innerHTML = `üî• ON FIRE! üî•<br>${streakNum} STREAK!`;
        playSound('streak');
        launchFireworks(3);
      } else if (streakNum >= 3) {
        celebration.classList.add('normal');
        celebration.innerHTML = `‚ö° ${streakNum} STREAK! ‚ö°`;
        playSound('streak');
      }
      
      if (streakNum >= 3) {
        document.body.appendChild(celebration);
        setTimeout(() => celebration.remove(), 1500);
      }
    }

    function showAchievement(icon, title, description) {
      const achievement = document.createElement('div');
      achievement.className = 'achievement';
      achievement.innerHTML = `
        <div class="achievement-icon">${icon}</div>
        <div class="achievement-text">
          <h3>${title}</h3>
          <p>${description}</p>
        </div>
      `;
      document.body.appendChild(achievement);
      playSound('streak');
      setTimeout(() => achievement.remove(), 4500);
    }

    // ============ SCREENS ============
    function showMainMenu() {
      gameMode = 'menu';
      correctScore = 0;
      wrongScore = 0;
      streak = 0;
      
      const container = document.getElementById('game-container');
      container.classList.remove('rainbow-border');
      
      const badgeCount = earnedBadges.length;
      
      document.getElementById('game-content').innerHTML = `
        <div class="main-menu">
          <h1>üéÆ Pok√©mon Guesser</h1>
          <p class="subtitle">Test your Pok√©mon knowledge!</p>
          
          <div class="menu-buttons">
            <button class="menu-btn random" onclick="startRandomMode()">
              <span class="icon">üé≤</span>
              <span>Random Mode</span>
            </button>
            <button class="menu-btn challenge" onclick="showTypeSelection()">
              <span class="icon">üèÜ</span>
              <span>Type Challenge</span>
            </button>
            <button class="menu-btn badges" onclick="showBadgeCollection()">
              <span class="icon">üéñÔ∏è</span>
              <span>Badge Collection (${badgeCount}/18)</span>
            </button>
          </div>
          
          <div class="badge-collection">
            <h3>üèÖ Your Badges</h3>
            <div class="badges-grid">
              ${TYPES.map(type => {
                const earned = earnedBadges.includes(type);
                return `
                  <div class="badge-slot ${earned ? 'earned type-' + type : 'locked'}">
                    ${earned ? TYPE_ICONS[type] : 'üîí'}
                    <div class="badge-tooltip">${type.charAt(0).toUpperCase() + type.slice(1)}${earned ? ' ‚úì' : ''}</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
          
          ${bestStreak > 0 ? `<p style="margin-top: 20px; color: #aaa;">Best Streak: üî• ${bestStreak}</p>` : ''}
        </div>
      `;
    }

    function showTypeSelection() {
      gameMode = 'type-select';
      
      document.getElementById('game-content').innerHTML = `
        <div class="type-selection">
          <h2>üèÜ Type Challenge</h2>
          <p style="color: #aaa; margin-bottom: 20px;">Guess ${BADGE_GOAL} Pok√©mon of a type to earn its badge!</p>
          
          <div class="types-grid">
            ${TYPES.map(type => {
              const progress = challengeProgress[type] || 0;
              const earned = earnedBadges.includes(type);
              const progressPercent = (progress / BADGE_GOAL) * 100;
              return `
                <button class="type-select-btn type-${type}" onclick="startChallengeMode('${type}')">
                  ${TYPE_ICONS[type]} ${type.toUpperCase()}
                  ${earned ? '<span class="badge-earned">‚úì</span>' : ''}
                  <div class="progress" style="width: ${progressPercent}%"></div>
                </button>
              `;
            }).join('')}
          </div>
          
          <button class="back-btn" onclick="showMainMenu()">‚Üê Back to Menu</button>
        </div>
      `;
    }

    function showBadgeCollection() {
      gameMode = 'badges';
      
      document.getElementById('game-content').innerHTML = `
        <div class="type-selection">
          <h2>üéñÔ∏è Badge Collection</h2>
          <p style="color: #aaa; margin-bottom: 20px;">You've earned ${earnedBadges.length} of 18 badges!</p>
          
          <div class="types-grid">
            ${TYPES.map(type => {
              const progress = challengeProgress[type] || 0;
              const earned = earnedBadges.includes(type);
              return `
                <div class="type-select-btn type-${type}" style="cursor: default; ${!earned ? 'opacity: 0.5; filter: grayscale(0.8);' : ''}">
                  ${earned ? TYPE_ICONS[type] : 'üîí'} ${type.toUpperCase()}
                  ${earned ? '<span class="badge-earned">‚úì</span>' : `<span style="font-size:0.7rem">${progress}/${BADGE_GOAL}</span>`}
                </div>
              `;
            }).join('')}
          </div>
          
          <button class="back-btn" onclick="showMainMenu()" style="margin-top: 20px;">‚Üê Back to Menu</button>
        </div>
      `;
    }

    function showBadgeEarnedScreen(type) {
      playSound('epic');
      launchConfetti(300);
      launchFireworks(10);
      createEmojiExplosion([TYPE_ICONS[type], 'üèÜ', 'üéâ', '‚ú®', 'üåü'], 40);
      
      const progress = challengeProgress[type];
      
      document.getElementById('game-content').innerHTML = `
        <div class="badge-earned-screen">
          <h1>üéâ BADGE EARNED! üéâ</h1>
          
          <div class="earned-badge-display type-${type}">
            ${TYPE_ICONS[type]}
          </div>
          
          <h2 style="text-transform: uppercase; margin-bottom: 10px;">${type} Badge</h2>
          <p>You've mastered ${type}-type Pok√©mon!</p>
          
          <div class="stats">
            <div>‚úÖ Pok√©mon Identified: ${progress}</div>
            <div>üéñÔ∏è Total Badges: ${earnedBadges.length}/18</div>
          </div>
          
          <div class="button-row" style="margin-top: 20px;">
            <button class="menu-btn challenge" onclick="showTypeSelection()">
              Continue Challenges
            </button>
            <button class="menu-btn random" onclick="showMainMenu()">
              Main Menu
            </button>
          </div>
        </div>
      `;
    }

    // ============ GAME MODES ============
    function startRandomMode() {
      gameMode = 'random';
      currentType = null;
      correctScore = 0;
      wrongScore = 0;
      streak = 0;
      loadRandomPokemon();
    }

    async function startChallengeMode(type) {
      gameMode = 'challenge';
      currentType = type;
      correctScore = challengeProgress[type] || 0;
      wrongScore = 0;
      streak = 0;
      
      // Fetch all Pokemon of this type
      document.getElementById('game-content').innerHTML = `
        <div class="loading">
          <div class="pokeball-loader"></div>
          <p>Loading ${type}-type Pok√©mon...</p>
        </div>
      `;
      
      try {
        const response = await fetch(`https://pokeapi.co/api/v2/type/${type}`);
        const data = await response.json();
        pokemonOfType = data.pokemon.map(p => p.pokemon);
        loadRandomPokemon();
      } catch (error) {
        document.getElementById('game-content').innerHTML = `
          <div class="loading">
            <p>Error loading Pok√©mon.</p>
            <button onclick="showTypeSelection()" class="back-btn">Back</button>
          </div>
        `;
      }
    }

    async function loadRandomPokemon() {
      revealed = false;
      hintsUsed = 0;
      attempts = 0;
      
      const container = document.getElementById('game-container');
      container.classList.remove('rainbow-border');
      document.body.classList.remove('correct-bg', 'wrong-bg');
      
      document.getElementById('game-content').innerHTML = `
        <div class="loading">
          <div class="pokeball-loader"></div>
          <p>Loading Pok√©mon...</p>
        </div>
      `;

      try {
        let pokemonUrl;
        
        if (gameMode === 'challenge' && pokemonOfType.length > 0) {
          const randomIndex = Math.floor(Math.random() * pokemonOfType.length);
          pokemonUrl = pokemonOfType[randomIndex].url;
        } else {
          const randomId = Math.floor(Math.random() * 898) + 1;
          pokemonUrl = `https://pokeapi.co/api/v2/pokemon/${randomId}`;
        }
        
        const response = await fetch(pokemonUrl);
        currentPokemon = await response.json();

        const speciesResponse = await fetch(currentPokemon.species.url);
        const speciesData = await speciesResponse.json();
        currentPokemon.generation = speciesData.generation.name.replace('generation-', '').toUpperCase();

        currentImageUrl = currentPokemon.sprites.other['official-artwork'].front_default 
                         || currentPokemon.sprites.front_default;

        renderGame();
      } catch (error) {
        document.getElementById('game-content').innerHTML = `
          <div class="loading">
            <p>Error loading Pok√©mon.</p>
            <button onclick="loadRandomPokemon()" class="menu-btn random">Try Again</button>
            <button onclick="showMainMenu()" class="back-btn" style="margin-top:10px;">Main Menu</button>
          </div>
        `;
      }
    }

    function renderGame() {
      const statLabels = ['HP', 'Attack', 'Defense', 'Sp. Atk', 'Sp. Def', 'Speed'];
      const statClasses = ['hp', 'attack', 'defense', 'sp-atk', 'sp-def', 'speed'];
      
      const types = currentPokemon.types.map(t => 
        `<span class="type-badge type-${t.type.name}">${t.type.name}</span>`
      ).join('');

      const stats = currentPokemon.stats.map((stat, i) => {
        const percentage = Math.min((stat.base_stat / 255) * 100, 100);
        return `
          <div class="stat-row">
            <div class="stat-name">${statLabels[i]}</div>
            <div class="stat-bar-container">
              <div class="stat-bar stat-${statClasses[i]}" data-width="${percentage}"></div>
            </div>
            <div class="stat-value">${stat.base_stat}</div>
          </div>
        `;
      }).join('');

      const totalStats = currentPokemon.stats.reduce((sum, s) => sum + s.base_stat, 0);

      // Challenge mode progress bar
      let progressHtml = '';
      if (gameMode === 'challenge') {
        const progress = challengeProgress[currentType] || 0;
        const progressPercent = (progress / BADGE_GOAL) * 100;
        const isAlmost = progress >= BADGE_GOAL - 3;
        progressHtml = `
          <div class="challenge-progress">
            <div class="type-label">
              <span class="type-badge-large type-${currentType}">${TYPE_ICONS[currentType]} ${currentType.toUpperCase()}</span>
              Challenge
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar ${isAlmost ? 'almost' : ''}" style="width: ${progressPercent}%"></div>
              <span class="progress-text">${progress} / ${BADGE_GOAL}</span>
            </div>
          </div>
        `;
      }

      document.getElementById('game-content').innerHTML = `
        ${progressHtml}
        
        <div class="score-board">
          <span id="correct-span">‚úÖ <span id="correct-score">${correctScore}</span></span>
          <span id="wrong-span">‚ùå <span id="wrong-score">${wrongScore}</span></span>
          <span id="streak-span">üî• <span id="streak">${streak}</span></span>
        </div>

        <div class="whos-that">Who's That Pok√©mon?</div>
        
        <div class="mystery-pokemon">
          <div class="mystery-icon">‚ùì</div>
          <div class="mystery-text">Use the stats to guess!</div>
        </div>

        <div id="hint-text" class="hint-text"></div>

        <div class="hints-section">
          <div class="types-container">${types}</div>
          <div class="stats-container">${stats}</div>
          <div class="extra-hints">
            <div class="hint-item">
              <div class="hint-label">Total Stats</div>
              <div>${totalStats}</div>
            </div>
            <div class="hint-item">
              <div class="hint-label">Height</div>
              <div>${(currentPokemon.height / 10).toFixed(1)}m</div>
            </div>
            <div class="hint-item">
              <div class="hint-label">Weight</div>
              <div>${(currentPokemon.weight / 10).toFixed(1)}kg</div>
            </div>
            <div class="hint-item">
              <div class="hint-label">Generation</div>
              <div>${currentPokemon.generation}</div>
            </div>
          </div>
        </div>

        <div id="result" class="result"></div>
        <div class="attempts" id="attempts-text"></div>

        <div class="guess-section">
          <input type="text" id="guess-input" placeholder="Enter Pok√©mon name..." autocomplete="off">
          <button id="submit-btn" onclick="submitGuess()">Guess!</button>
        </div>

        <div class="button-row">
          <button id="hint-btn" onclick="showHint()">üí° Hint</button>
          <button id="skip-btn" onclick="skipPokemon()">‚è≠Ô∏è Skip</button>
          <button class="back-btn" onclick="showMainMenu()">üè† Menu</button>
        </div>
      `;

      setTimeout(() => {
        document.querySelectorAll('.stat-bar').forEach((bar, i) => {
          setTimeout(() => bar.style.width = bar.dataset.width + '%', i * 100);
        });
      }, 100);

      document.getElementById('guess-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') submitGuess();
      });

      document.getElementById('guess-input').focus();
    }

    function submitGuess() {
      if (revealed) return;

      const input = document.getElementById('guess-input');
      const guess = input.value.trim().toLowerCase();
      
      if (!guess) return;

      attempts++;
      updateAttempts();

      const correctName = currentPokemon.name.toLowerCase();
      const normalizedGuess = guess.replace(/[.\s-]/g, '');
      const normalizedCorrect = correctName.replace(/[.\s-]/g, '');

      if (normalizedGuess === normalizedCorrect) {
        showResult(true);
      } else {
        playSound('wrong');
        createScreenFlash('red');
        createScreenCrack();
        
        const container = document.getElementById('game-container');
        container.classList.add('shake');
        setTimeout(() => container.classList.remove('shake'), 600);
        
        document.body.classList.add('wrong-bg');
        setTimeout(() => document.body.classList.remove('wrong-bg'), 500);
        
        const rect = input.getBoundingClientRect();
        launchWrongParticles(rect.left + rect.width / 2, rect.top);
        createEmojiExplosion(['‚ùå', 'üíî', 'üòµ', 'üö´'], 8);
        
        input.classList.add('wrong');
        input.value = '';
        input.placeholder = 'Wrong! Try again...';
        
        setTimeout(() => {
          input.classList.remove('wrong');
          input.placeholder = 'Enter Pok√©mon name...';
        }, 1000);
      }
    }

    function showResult(correct) {
      revealed = true;
      
      const resultDiv = document.getElementById('result');
      const container = document.getElementById('game-container');
      const input = document.getElementById('guess-input');

      if (correct) {
        correctScore++;
        streak++;
        if (streak > bestStreak) {
          bestStreak = streak;
          saveGameData();
        }
        
        const isPerfect = attempts === 1 && hintsUsed === 0;

        // Challenge mode progress
        let badgeEarned = false;
        if (gameMode === 'challenge') {
          challengeProgress[currentType] = (challengeProgress[currentType] || 0) + 1;
          
          if (challengeProgress[currentType] >= BADGE_GOAL && !earnedBadges.includes(currentType)) {
            earnedBadges.push(currentType);
            badgeEarned = true;
          }
          saveGameData();
        }

        // Effects
        playSound('correct');
        createScreenFlash('green');
        createScreenFlash('gold');
        document.body.classList.add('correct-bg');
        
        container.classList.add('flash-correct');
        setTimeout(() => container.classList.remove('flash-correct'), 500);
        
        if (streak >= 3) container.classList.add('rainbow-border');
        
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        
        launchConfetti(200);
        launchSparks(centerX, centerY, 50);
        launchStars(centerX, centerY, 15);
        createRingBurst('#2ecc71');
        createEmojiExplosion(['üéâ', 'üéä', '‚ú®', 'üåü', 'üí´', '‚≠ê', 'üèÜ', 'üëè'], 25);
        setTimeout(() => launchFireworks(3), 300);
        
        input.classList.add('correct-input');
        
        const correctSpan = document.getElementById('correct-span');
        correctSpan.classList.add('mega-pop');
        setTimeout(() => correctSpan.classList.remove('mega-pop'), 600);
        
        const streakSpan = document.getElementById('streak-span');
        streakSpan.classList.add('pop');
        if (streak >= 10) {
          streakSpan.classList.remove('streak-fire');
          streakSpan.classList.add('streak-legendary');
        } else if (streak >= 3) {
          streakSpan.classList.add('streak-fire');
        }
        setTimeout(() => streakSpan.classList.remove('pop'), 400);
        
        showStreakCelebration(streak);
        
        // Result message
        let resultMessage = `üéâ Correct!`;
        let subMessage = `You got it in ${attempts} attempt${attempts > 1 ? 's' : ''}`;
        if (hintsUsed > 0) subMessage += ` with ${hintsUsed} hint${hintsUsed > 1 ? 's' : ''}`;
        
        resultDiv.className = 'result correct';
        resultDiv.innerHTML = `
          <h2>${resultMessage}</h2>
          <div class="pokemon-reveal">
            <img src="${currentImageUrl}" alt="${currentPokemon.name}" class="correct-reveal">
          </div>
          <h2>It's ${currentPokemon.name}!</h2>
          <p>${subMessage}</p>
          ${isPerfect ? '<div class="perfect-badge">‚≠ê PERFECT! ‚≠ê</div>' : ''}
          ${streak >= 3 ? `<p style="margin-top:10px">üî• ${streak} Streak!</p>` : ''}
        `;

        updateScores();

        document.getElementById('guess-input').disabled = true;
        document.getElementById('submit-btn').disabled = true;
        
        // Check for badge earned
        if (badgeEarned) {
          document.querySelector('.button-row').innerHTML = `
            <button id="next-btn" onclick="showBadgeEarnedScreen('${currentType}')">üèÜ Claim Badge!</button>
          `;
        } else {
          document.querySelector('.button-row').innerHTML = `
            <button id="next-btn" onclick="loadRandomPokemon()">Next Pok√©mon ‚Üí</button>
            <button class="back-btn" onclick="showMainMenu()">üè† Menu</button>
          `;
        }
        
      } else {
        wrongScore++;
        streak = 0;
        
        createScreenFlash('red');
        createScreenCrack();
        
        container.classList.add('mega-shake', 'flash-wrong');
        setTimeout(() => container.classList.remove('mega-shake', 'flash-wrong'), 800);
        
        document.body.classList.add('wrong-bg');
        setTimeout(() => document.body.classList.remove('wrong-bg'), 1000);
        
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        launchWrongParticles(centerX, centerY, 30);
        createEmojiExplosion(['üò¢', 'üíî', 'üò≠', 'üòû', 'üôÅ'], 15);
        
        const wrongSpan = document.getElementById('wrong-span');
        wrongSpan.classList.add('pop');
        setTimeout(() => wrongSpan.classList.remove('pop'), 400);
        
        const streakSpan = document.getElementById('streak-span');
        streakSpan.classList.remove('streak-fire', 'streak-legendary');
        container.classList.remove('rainbow-border');
        
        resultDiv.className = 'result incorrect';
        resultDiv.innerHTML = `
          <h2>üòî Too bad!</h2>
          <div class="pokemon-reveal">
            <img src="${currentImageUrl}" alt="${currentPokemon.name}" class="wrong-reveal">
          </div>
          <h2>It was ${currentPokemon.name}!</h2>
          <p>Better luck next time!</p>
        `;

        updateScores();

        document.getElementById('guess-input').disabled = true;
        document.getElementById('submit-btn').disabled = true;
        
        document.querySelector('.button-row').innerHTML = `
          <button id="next-btn" onclick="loadRandomPokemon()">Next Pok√©mon ‚Üí</button>
          <button class="back-btn" onclick="showMainMenu()">üè† Menu</button>
        `;
      }
    }

    function skipPokemon() {
      showResult(false);
    }

    function showHint() {
      if (revealed) return;
      
      playSound('hint');
      hintsUsed++;
      const hintText = document.getElementById('hint-text');
      const name = currentPokemon.name;
      
      hintText.classList.remove('pop');
      void hintText.offsetWidth;
      hintText.classList.add('pop');
      
      if (hintsUsed === 1) {
        hintText.textContent = `üí° First letter: "${name[0].toUpperCase()}"`;
      } else if (hintsUsed === 2) {
        hintText.textContent = `üí° Starts with: "${name.substring(0, 2).toUpperCase()}" ‚Ä¢ Length: ${name.length} letters`;
      } else if (hintsUsed === 3) {
        let hint = '';
        for (let i = 0; i < name.length; i++) {
          hint += (i % 2 === 0) ? name[i].toUpperCase() : '_';
        }
        hintText.textContent = `üí° Pattern: ${hint}`;
      } else {
        hintText.textContent = `üí° It's: "${name.substring(0, Math.ceil(name.length * 0.6)).toUpperCase()}..."`;
      }
    }

    function updateAttempts() {
      const text = document.getElementById('attempts-text');
      if (text) {
        text.textContent = `Attempts: ${attempts}`;
        text.style.animation = 'none';
        void text.offsetWidth;
        text.style.animation = 'pop 0.3s ease-out';
      }
    }

    function updateScores() {
      const correctEl = document.getElementById('correct-score');
      const wrongEl = document.getElementById('wrong-score');
      const streakEl = document.getElementById('streak');
      
      if (correctEl) correctEl.textContent = correctScore;
      if (wrongEl) wrongEl.textContent = wrongScore;
      if (streakEl) streakEl.textContent = streak;
    }

    // Initialize
    document.addEventListener('click', () => {
      if (audioContext.state === 'suspended') audioContext.resume();
    }, { once: true });

    showMainMenu();
  </script>
</body>
</html>